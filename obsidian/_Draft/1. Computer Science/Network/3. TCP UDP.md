> 데이터를 신뢰성있고 순서대로 전송하기 위한 L4 계층 프로토콜

> 신뢰성이 높지만, 흐름제어 혼잡제어 등 기능을 제공하다보니 헤더가 크고 느리다.

- TCP 전송의 경우, 도착지의 전송계층은, 도착한 **패킷의 순서를 맞춰서** 소켓에 올려보낸다.
- 데이터의 손실이 발생하면, 재전송 요청을 보냄으로 신뢰성을 확보한다.
- 혼잡제어, 연결관리, 흐름제어 등의 서비스를 제공하는 프로토콜로 헤더가 크다.


# 연결관리
---
- 3-way-handshake를 이용하여 연결 관리, 4-way로 연결 해제

1. SYN
   브라우저는 서버에게 연결을 시작하려는 의도를 알리기 위해 IP 주소로 SYN 패킷을 보내 연결을 시작
2. SYN-ACK 
   SYN 패킷을 받은 서버는 클라이언트의 연결 요청을 수락했으며 서로간의 통신 준비가 완료되었다는 사실을 알리기위해 요청을 준 클라이언트에게 SYN-ACK 패킷을 응답
3. ACK
   클라이언트는 SYN-ACK를 응답받으면 ACK 패킷을 보내 연결을 확정
   이 단계가 완료되면 TCP연결이 성공적으로 수립됩니다. 

> 2-way는 왜 신뢰성 없는가 ? `엇갈림 문제`
> 클라이언트가 연결 수립을 위해 Syn을 보냈고
> 서버는 이미 첫번째 Syn에 대한 Ack를 보냈던 것인데 아직 클라이언트에 도착하지 않은 것 뿐인데
> 
> 클라이언트는 Ack가 오지 않아 두번째 Syn을 보내게 된다.
> 즉 엇갈리는 문제가 발생한다.



# 신뢰성
---

1. CheckSum 오류검출 
	- TCP Segment가 생성될때 TCP Header에는 Checksum 부분이 있는데
	- TCP 헤더와 데이터를 포함하여 계산한 값이 Checksum에 담긴다. 
	- 수신자측이 다시 Checksum을 계산했는데, 실제 송신자가 적어둔 Checksum과 다르다면 오류
	- 잘 받았다면 Ack를 보내지만 , 오류라면 아무것도 보내지 않는다.
	- 아무것도 못받은 송신자는 세그먼트를 다시 보낸다.
	
2. TCP 세그먼트 누락
	- 수신자는 마지막으로 연결된 세그먼트에 대해 ACK를 보낸다.
	- 수신자는 버퍼에 연속되지 않은 세그먼트를 계속 받을 수는 있지만
	- 1번,2번 Segment를 받게된 경우 Segment 2에 대한 Ack를 전송 
	- 3번은 누락되고 4번 Segment를 받으면 , 그래도 Segment 2에 대한 Ack를 전송
	- 송신자측은 동일한 Ack가 연속적으로 오면 패킷이 누락되었다 판단하고 다시 Segment 3을 전송한다.

3. timeout 
	- 기본적으로 송신자는 timeout이 지날동안 ACK를 못받으면 다시 재전송한다.
	
4. 버퍼 순서
	- 버퍼로 세그먼트들을 받다가 모두 도착하면, 순서를 조합해서 상위 계층으로 전달한다.



# 흐름제어
---
흐름제어란 Sender에게 Receiver의 **버퍼 상태**를 알려주면서, 버퍼를 초과하는 상황을 예방하는 것이다.

- Receiver의 전송계층에서, App 계층으로 데이터를 올려보내려 해도, App이 바쁜 경우가 있다.
- 이때, Sender가 데이터 계속 보내게 되면, 버퍼 overflow(**패킷 드롭**)이 발생한다.
- 이것을 예방하고자 흐름제어를 한다.

1. 수신자 자신이 지금 감당할 수 있는 버퍼 크기를 ACK에 담아 전송한다.
2. 송신자는 ACK를 보고, 버퍼에 수신자가 받을 정도의 패킷만을 담는다.
3. 송신자는 수신자의 버퍼를 고려하여 데이터 전송을 조절한다.


# 혼잡제어
---
**네트워크 상태**를 고려하여 패킷 드롭이 발생하면 속도를 늦춰, 패킷드롭이 더 발생하지 않도록 하는 것

- 대역폭이 꽉 차서 패킷드롭이 발생하면, 모든 host들은 속도를 줄이게된다.
	- 하나만 줄이면, 다른 host가 대역폭을 차지하려고 하니까




# TCP와 UDP 차이
---
- UDP
	- 비연결형 바로 데이터 전송하여 - 속도가 빠르다
	- 따로 흐름제어 혼잡제어 같은 기능이 없어 헤더가 작고 네트워크 부하가 적다 대신 신뢰성 적다.
	- unicast(1:1), multicast(1:n), broadcast(n:n) 가능
- TCP
	- 3-way-handshake를 통해 연결후 통신하여 신뢰성이 있다.
	- 흐름제어, 혼잡제어 같은 기능을 제공하지만, 헤더가 커져 네트워크 부하가 크다.
	- unicast만 가능하다.