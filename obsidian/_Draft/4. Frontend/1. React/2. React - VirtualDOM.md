
# VirtualDOM
---
> VirtualDOM은  DOM 트리를 추상화해서 / 메모리상에 로드된  Javascript 객체다.
> - class, style과 react의 등을 가지고 있지만 DOM api 메서드 등은 가지고 있지 않다.


DOM을 직접 조작하여 화면을 업데이트 하려면
렌더트리 생성 -> 리플로우 -> 리페인트 -> 컴포짓 과정을 모두 거치게 됨
그리고 이런 작업이 빈번하게 일어난다면 많은 연산을 필요로하고 성능을 저하시킨다. 
DOM 조작의 비효율성을 개선하고자 등장한 개념으로, React에서 쓰이고 있다.

현재는 인터랙션과 복잡합 웹 어플리케이션들이 많아졌고 
이런 맥락에서 DOM 조작의 기본적인 비효율적인 업데이트를 개선하고자 등장한 것이 Virtual DOM이다. 
 



# 기본적인 Virtual DOM 컨셉
---

1. 화면이 렌더링되면 이 DOM tree를 가지고 최초의 VDOM을 만들어 메모리에 로드시킨다.
2. 16ms 단위로 배치로 처리되는 상태변경이 발생하면, 변경된 상태 기반으로 새로운 VDOM을 만든다.
	- 리액트는 상태를 비동기/배치 처리해서 일괄적으로 VDOM을 만들고
	- 메모리상의 VDOM을 만드는 것이기 때문에, 실제 DOM 조작보단 적은 리소스를 사용한다.
3. diff 과정 `diff(previous : VTree, current : VTree) => PatchObject `
	- 이전의 VDOM과 새롭게 만들어진 VDOM 을 비교하는 작업을 거친다. 
	- 그래서 VDOM에서 변경된 부분만을 확인하게 된다.
4. 실제 DOM에 적용 `patch(rootNode: DOMNode, patches:PatchObject)=> DOMNode`
	- 변경된 부분만을 실제 DOM에 적용한다.

> 즉 16ms마다 상태업데이트를 처리하고,
> 메모리상에 존재한 VDOM 을 통해 변경점을 찾고
> 실제 DOM에 변경점만을 업데이트하게 만들어 성능을 최적화한다. 



# React VirtualDOM
---





자바스크립트를 확장한 JSX문법을 통해 컴포넌트를 작성
JSX는 빌드타임에 바벨과 같은 툴에 의해 JS로 변환되는과정을 살펴보면

JSX 문법은 React.createElement 함수로 변환되고
함수의 반환값은 Javascript 객체가 된다 

이 Javascript객체를 ReactDOM.render 함수에 넘겨주면
실제 DOM에 적용되게 된다.



#### 재조정
VirtualDOM을 활용하여 실제 DOM을 업데이트 하는 과정을 말한다. 

- 비교단계 - Diffing 알고리즘 
	- 비교할때 타입(리엑트 엘리먼트 이름)을 먼저 비교하고
		- 타입이 같다면, "속성" 만 비교하고
		- 타입이 다르다면, 트리를 아예 재생성하기 위해 "다르다"고 판단 
			- (즉 자식들도 딸려서 모두 "다르다" 라고 판단")
	- 자식을 비교할때 순차적인 엘리먼트들이라면
		- 순차적인 비교를 하기 때문에, 리스트의 중간에 새로운 엘리먼트가 추가가 되면 
		- 뒤로 한칸씩 밀리는 모든 컴포넌트들이 새롭게 만들어졌다고 판단하게 되는데
		- 이것을 리액트에게 새로운 컴포넌트가 아님을 알리는 것이 key props다.
			- 그래서 인덱스 같은 것들을 key에 넣으면 안된다. 
			




 