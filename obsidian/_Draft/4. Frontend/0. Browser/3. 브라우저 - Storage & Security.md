
# [ 1 ] Web Storage
---
### [ 1-1 ] LocalStorage 

로컬 스토리지는 브라우저에 데이터를 영구적으로 저장하는 메커니즘입니다. 데이터는 사용자의 로컬 시스템에 저장되며, 브라우저를 닫았다가 다시 열어도 데이터가 유지됩니다. 로컬 스토리지에 저장된 데이터는 JavaScript를 사용하여 읽고 쓸 수 있습니다.


### [ 1-2 ] SessionStorage 

세션 스토리지는 로컬 스토리지와 유사하지만, 데이터가 세션(session) 동안만 유지됩니다. 세션은 사용자가 브라우저를 열고 닫을 때까지의 시간을 나타냅니다. 브라우저를 닫으면 세션 스토리지에 저장된 데이터가 삭제됩니다.
	1. 비로그인 장바구니

### [ 1-3 ] Cookie

쿠키는 서버가 클라이언트의 로컬 시스템에 저장하는 작은 데이터 조각입니다. 쿠키는 HTTP 요청과 함께 서버에 전송되어 서버 측에서 클라이언트를 식별하거나 상태 정보를 유지하는 데 사용됩니다. 쿠키는 만료 날짜 및 시간을 설정하여 영속적이거나 세션 동안만 유지될 수 있습니다.

크기 제한이 있다. 

 - Secure Cooke : 쿠키가 오직 HTTPS 프로토콜을 통해 전송되어야 함
	 - 네트워크를 통해 전송될 때 도청(중간자 공격)으로부터 보호하기 위해 사용
 - SameSite Cookie 
	 - `Strict`: 같은 사이트에서만 쿠키를 전송합니다. 즉, 사용자가 직접 URL을 입력하거나 사이트 내의 링크를 클릭할 때만 쿠키가 포함됩니다.
	 - 사용자를 대신하여 자동으로 이루어지는 요청(예: CSRF 공격)에 대해 쿠키를 보호하기 위해 사용됩니다.
 - httpOnly Cookie :쿠키에 JavaScript를 통한 접근을 금지합니다.
	 - 쿠키 정보가 XSS 공격을 통해 탈취되는 것을 방지하기 위해 사용됩니다.


 




# [ 3 ]Web Security
---
### [ 3-1 ] Same Origin Policy (SOP)

웹 브라우저가 다른 출처(Origin)의 리소스에 대한 접근을 제한하는 웹 보안 정책
출처에 대한 식별은 프로토콜 + 도메인 + Port 의 조합으로 식별된다. 

브라우저의 SOP 정책에 의해 제한되는 동작은
1. Document 객체 접근 
2. 다른 출처의 페이지에 저장된 Web Storage 접근 
3. 다른 출처의 리소스를 요청하는 것
4. image, iframe, script등은 불러와서 임베드 시킬 수는 있지만 안의 리소스에는 접근 불가

SOP 정책을 안전하게 완화하기 위해 `CORS` 매커니즘이 존재한다. 


 
### [ 3-2 ] CORS 

SOP 정책을 안전하게 완화하기 위한 매커니즘으로 
주로 출처가 다른 리소스에 대한 http 요청에 대한 제한을 완화 할 수 있다.
(즉 웹스토리지 접근 제한 같은 것은 완화 못함)

서버가 응답을 줄 때 허용하는 사이트들을 http header `access-control-allow origin`에 담고
허용하는 메소드들은 `access-control-allow Methods` 헤더에 담아서 응답을 보낸다.

브라우저는 Origin이 달라도 허용하는 사이트 리스트의 지금 요청을 보낸 Origin이 존재하면
리소스 접근을 허용한다.

> 이런것이 안되면 Proxy 서버를 구축해서 하면 되는거지 뭐 Next API Route를 쓰거나 

 https://ssocoit.tistory.com/235





# [ 4 ] 중요한 인증정보는 어디에 저장할까 ?
---
stateless한 웹 통신에서 유저 인증정보를 session이나 JWT 형태로 클라이언트가 들고 있게 되는데
이 인증정보를 어디에 담아서 보안을 유지할지에 대해 고민해봐야 된다. 

먼저 CSRF 공격은 `특정 작업을 유저인척 하고 진행`하는 것이다
1. 유저가 이미 로그인되어 있고 쿠키에 정보가 저장되어 있다.
2. 공격자는 악성 스크립트가 심어진 페이지에 접속하도록 유도한다.
	1. 게시판에 `<script> <img>` src에 url과 동작을 명시해두면 SOP에 필터링 되지 않는다.
3. 페이지에 접속하면 SOP에 필터링 되지 않은 리소스로 요청이 보내지게되고
4. 이에 쿠키는 Origin이 같은 요청이면 딸려나가게 된다. 

XSS 공격은 `javascript를 실행시키거나 해커의 서버에 요청을 보내게 만드는 것`
1. 게시판이 있는 사이트에 `<script>` 를 올려두고 다른 유저가 읽으면 
2. javascript로 Web Storage를 읽어서 해커의 서버로 전송하는 방식


이런공격을 방어하기 위해서 AccessToken을 짧게하고 RefreshToken을 일회성으로만 쓰게 만드는 방법이 있는데, 결국 Token들도 웹스토리지에 저장해야하므로 이것만으로 충분하진 않다. 


> 보통 CSRF 보다 XSS를 우선순위 둬서 막는다고 한다는데, 그래서 보통 Cookie를 선호한다.
> 다양한 방어방법이 있기 때문

### Cookie에 저장할거면 
---
- httpOnly 옵션을 사용해서 = 클라이언트에서 Cookie를 읽지 못하게 만들어서 XSS 를 방어
- sameSite 옵션을 strict로 설정해서 현재페이지 url과 요청받는 도메인이 같아야만 쿠키가 전송되도록해서 CSRF를 방어한다. 
- 서버에서는 Referer Check를 하거나
- CSRF 토큰 - 세션사용한다는데, 


### LocalStorage에 저장 
---
XSS에 가장 중점을 둬서 방어해야되는데 
- CSP 설정하여, 클라이언트에서 스크립트 출처를 파악해서, 악의적인 스크립트 실행을 방지하거나 